<meta charset="utf-8">
<link rel="stylesheet" href="style.css">
<h1>May the fork() be with you !</h1>

<p>
Dans ce TP nous allons faire un peu de traitement d'image pour répondre à une demande de Maitre Yoda :
il a besoin d'un outil permettant de flouter certaines images de Leïa prises au nightclub d'Alderaan ...
</p>
<blockquote><h1>&ldquo;Un peu trop fraiche, elle est&rdquo;</h1>-<i>Maitre Yoda, édition du Dagobahlmasqué, -2 av.BY </i>
</blockquote>

<p>
Tu as en ta possession un programme <a>blur.c</a> permettant de réaliser cette opération.
Afin de tester ton programme, une des images qui a fait le tour du sénat galactique t'est donnée : <strong>leia.ppm</strong>.<br>
(<i>L'ordre Jedi, bien conscient du caractère quasi insoutenable de cette mission, te prie de ne pas basculer du côté obscur lors de son déroulement.</i>)
</p>

<h2>Gestion des jobs avec bash</h2>

<p>
Jeune Padawan, commence ton initiation en te familiarisant avec la gestion des jobs et processus depuis ton shell.<br>
Grâce à la Force (ou ton terminal si t'es pas encore tip top niveau midi-chloriens), tappe successivement ces commandes :
</p>
<ul>
<li><kbd>eog leia.ppm</kbd>
<li>Ctrl+Z
<li><kbd>jobs</kbd>
<li><kbd>bg</kbd>
<li><kbd>jobs</kbd>
<li><kbd>gedit blur.c &</kbd>
<li><kbd>jobs</kbd>
<li><kbd>fg %1</kbd>
<li>Ctrl+C
<li><kbd>jobs</kbd>
<li><kbd>ps</kbd>
<li><kbd>kill %1</kbd>
<li><kbd>jobs</kbd>
<li><kbd>ps -ef</kbd> et repère le <var>PID</var> de ton shell
<li><kbd>kill -9 <var>PID</var></kbd>
</ul>
<p>
T'as pas compris ? Bah, recommence Jar Jar !
</p>
<p>
Compile le programme <a>blur.c</a> et lance-le, avec ou sans <code>nice</code>, sur des flous de rayon 10, 20 et 30.
Utilise les commandes <code>time</code> et <code>top</code> pour voir la différence.
</p>

<h2>Traitement parallèle avec fork</h2>

<p>
On veut flouter l'image plus rapidement et comme La Force ca roule du tonnerre, on se dit qu'un traitement en parallèle ca peut lui mettre des étoiles dans les yeux à notre ami Yoda.
</p>
<p>
Transforme le programme blur.c pour qu'il floute les couches de l'image en parallèle avec un process différent par couche. Il faudra faire quatre processus : un père qui attend, trois fils qui calculent. 
Le réassemblage des données se fera à l'aide de fichiers temporaires.
</p>
<p>
Si t'as l'intention d'entrer au conseil Jedi, utilise <code>clock()</code>, <code>top</code>, <code>time</code> et <code>gprof</code> en recommençant le flou 100 fois, et décris le comportement des processus ainsi créés.
</p>
<p>
(NB : Un vrai maitre Jedi crée ses fichiers temporaires avec <code>tmpfile()</code>).
</p>

<h2>Une petite amélioration</h2>

<p>
Quoi t'en veux encore ? Modifie le programme précédent pour que la Force affiche l'image floutée avec le programme <code>display</code> sans l'enregistrer dans un fichier.
</p>
<p>
On suggère d'utiliser <code>execl()</code>, <code>tmpfile()</code> et <code>dup2()</code>.
</p>
<p> Que la Force soit avec toi ! </p>
